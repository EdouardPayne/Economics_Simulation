<!DOCTYPE html>
<html>
  <head>
        <!-- Latest compiled and minified CSS -->

        <script src="files/amcharts/amcharts.js"></script>
        <script src="files/amcharts/serial.js"></script>
        <script src="files/amcharts/pie.js"></script>
        <script src="files/entities.js"></script>
        <script src="files/updateUI.js"></script>
        <link rel="stylesheet" type="text/css" href="files/custom.css">
        <script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
        <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
        <script src="https://www.amcharts.com/lib/3/themes/light.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <script src="http://cdn.jsdelivr.net/qtip2/3.0.3/jquery.qtip.min.js"></script>
        <link rel="stylesheet" href="http://cdn.jsdelivr.net/qtip2/3.0.3/jquery.qtip.min.css">

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <meta charset="utf-8">
    <title>Business Economics Games</title>
  </head>

  <body>
    <div class="container">
          <div class="intro">
                <div class="jumbotron">
                  <h3>Welcome to the business game! Enter your company details </h3>
                </div>
                  

                  <br>    
                          
                  <form>
                    Enter Business Name:
                    <div class="form-group">
                      <input type="text" name="name" id="name" class="form-control" placeholder="Your Name">
                    </div>
                    <div class="form-group">
                      <input type="text" name="capital" id="capital" class="form-control" placeholder="Capital">
                    </div>
                    <div class="form-group">
                      <input type="text" name="employees" id="employees" class="form-control" placeholder="Employees">
                    </div>
                    Select Sector:
                    <div class="form-group">
                      <select id="sectorPrices" class="form-control">
                        <option value="primary">Primary sector</option>
                        <option value="secondary">Secondary / manufacturing sector</option>
                        <option value="service">Service / ‘tertiary’ sector</option>
                      </select>
                    </div>
                    
                  </form>
                  <button id="businessSubmit" class="btn btn-default" class="form-control">Submit Business Details</button>
                  <br>           
          </div>
          <div class="row overview">



            <div class="col-md-12">
              
                
                <ul class="nav nav-tabs">
                    <li class="active"><a data-toggle="tab" href="#companyPage">Company Information</a></li>
                    <li><a data-toggle="tab" href="#marketPage">Market Information</a></li>
                    <li><a data-toggle="tab" href="#countriesPage">Country Information</a></li>
                    <li><a data-toggle="tab" href="#MacroPage">Economics Shocks</a></li>
                    <li><a data-toggle="tab" href="#productionPage">Produce Output</a></li>
                    <li><a data-toggle="tab" href="#upgradePage">Upgrade Business</a></li>
                    <li><a data-toggle="tab" href="#diagramPage">Statistics</a></li>
                </ul>
              </div>
              <div class="row">
                <div class="col-md-2">
                  <h2>
          
                    <button onclick="Tick()" id="nextday"  class="btn btn-primary"  data-toggle="tooltip" title="In order to proceed to next day go to 'Produce Output' tab and produce output and sell it">Simulate Next Day</button>
       
                  </h2>
                </div>
                <div class="col-md-10">
                  <div class="tab-content">
                    <div class="companyDetails tab-pane fade in active" id="companyPage">
                      <h2>Company Details</h2>
                      <table style="width:100%">
                        <tr>
                          <th>Company Name</th>
                          <th>Number of Employees</th>
                          <th>Number of Capital</th> 
                          <th>Stock</th> 
                          <th>Cash</th>
                        </tr>
                        <tr>
                          <td id="companyName"></td>
                          <td id="numberEmployees"></td>
                          <td id="numberCapital"></td>  
                          <td id="stockLevels"></td>
                          <td id="cash"></td> 
                        </tr>
                      </table>
                    </div>

                    <div class="marketDetails tab-pane fade"  id="marketPage">



                      <h2>Market Details</h2>            
                      <ul class="nav nav-tabs" id="marketInfo">

                      </ul>
                      <div class="tab-content" id="dynamicTable">



                      </div>
                    </div>
                    <div class="country tab-pane fade" id="countriesPage">
                      <h2>Countries Information</h2>
                      <ul class="nav nav-tabs" id="countryInfo">

                      </ul>
                      <div class="tab-content" id="dynamicTableCountry">



                      </div>
                    </div>

                    <div class="macro tab-pane fade" id="MacroPage">
                      <h2>Latest Economic Information</h2>
                      <pre id="economic_info">

                      </pre>
                    </div>
                    
                    <div class="manageProduction tab-pane fade" id="productionPage">
                      <h2>Manage Production</h2>
                        <div class="row">
                          <div class="updateProductionDetails col-md-9">
                            <h3>Update Production Details</h3>

                            <form>
                              <input input type="number" id="capitalUpdate" placeholder="Update Capital Amount"></input>
                              <input input type="number" id="employeesUpdate" placeholder="Update Employee Amount"></input>
                              <button type='button' id="productionCreate">Produce Output</button>
                            </form>
                              <div class="row">
                                <div class="col-md-6">
                                    <h4>Estimated Cost:</h4>
                                    
                                    <p>Capital Cost:</p> <span id="capitalCost"></span>
                                    <p>Labor Cost:</p><span id="laborCost"></span>
                                    <p>Land Cost</p><span id="landCost"></span>
                                    <p>Total Cost:</p><span id="totalCost"></span>

                                    <h4>Estimated Income</h4>
                                    
                                    <p>Price of Output:</p> <span id="priceOutput"></span>
                                    <p>Quantity:</p><span id="quantityOutput"></span>
                                    <p>Income:</p><span id="incomeOutput"></span>

                                    <h4>Profit</h4>
                                    
                                    <p>Profit</p> <span id="profitGoods"></span>
                                </div>
                                <div class="col-md-6">
                                  <h4>Business Advisor:</h4>
                                  <p id="businessAdviceOUTPUT"></p>
                                  <p id="businessAdvicePM"></p>
                                </div>
                              </div>
                          </div>
                          <div class="sellOutput col-md-3">
                            <h3>Sell Output</h3>
                            <form>
                              <input input type="number" id="sellAmount" placeholder="Select Amount you want to sell"></input>
                              <button type='button' id="sellOutput">Sell Ouput</button>
                            </form>
                          </div>
                        </div>
                    </div>
                    <div class="upgradeBusiness tab-pane fade" id="upgradePage">
                      <h3> You Can Upgrade your business here </h3>

                      <button type="button" id="startUp" disabled>Start-up</button>
                      <button type="button" id="mediumFirm" disabled>Medium Firm</button>
                    </div>

                    <div class="diagrams tab-pane fade" id="diagramPage">
                      <div id="marketShare" style="width: 640px; height: 400px;"></div>
                      <div id="priceLabor" style="width: 640px; height: 400px;"></div>
                      <div id="priceCapital" style="width: 640px; height: 400px;"></div>
                      <div id="GDPLevel" style="width: 640px; height: 400px;"></div>
                    </div>
                  </div>

                </div>

              </div>

              </div>  
            </div>
         

    
  </body>


    <script>
 
    var game = {
      tickCount:0,
    }

var filterInt = function(value) {
  if (/^(\-|\+)?([0-9]+|Infinity)$/.test(value))
    return Number(value);
  return NaN;
}




modifyDOM = function(){

  CountryDOM = []
  for (var key in Market.list) {
    CountryDOM.push(Market.list[key].country);
    }


  var UniqueCounties = CountryDOM.filter(function(elem, pos) {
    return CountryDOM.indexOf(elem) == pos;  //http://mikeheavers.com/tutorials/removing_duplicates_in_an_array_using_javascript/
  });
  for(key in Country.list){
    simple = Country.list[key].country.replace(/\s+/, "")
    $( "#countryInfo" ).append("<li><a data-toggle='tab' href=#"+simple+"_macro>"+Country.list[key].country+"</a></li>")

    $("#dynamicTableCountry").append("<div class='tab-pane' id="+simple+"_macro>")
    var table = $('<table style="width:50%"></table>').attr('id', simple+'_tableMacro');
    $("#"+simple+"_macro").append(table);
    var country = Country.list[key]
    for(key2 in country){
        var type = $('<tr></tr>').attr('id', country[key2].name+'_table');

        var name = $('<td></td>').text(country[key2].name);
        var demand = $('<td></td>').text(country[key2].demand);
        var supply = $('<td></td>').text(country[key2].supply);
        var price = $('<td></td>').text(country[key2].price);

        table.append(type);
        type.append(name);
        type.append(demand);
        type.append(supply);
        type.append(price);
    }
  }


  for (var i = 0; i < UniqueCounties.length; i++) {
    simple = UniqueCounties[i].replace(/\s+/, "") 
    $( "#marketInfo" ).append("<li><a data-toggle='tab' href=#"+simple+">"+UniqueCounties[i]+"</a></li>")
     
    $("#dynamicTable").append("<div class='tab-pane' id="+simple+">")

    var table = $('<table style="width:50%"></table>').attr('id', simple+'_table');
    $("#"+simple).append(table);



    for(key in Market.list){
      if(Market.list[key].country == UniqueCounties[i]){
        var sector = $('<tr></tr>').attr('id', Market.list[key].sector+'_table');

        var name = $('<td></td>').text(Market.list[key].sector);
        var demand = $('<td></td>').text(Market.list[key].demand);
        var supply = $('<td></td>').text(Market.list[key].supply);
        var price = $('<td></td>').text(Market.list[key].price);


        table.append(sector);
        sector.append(name);
        sector.append(demand);
        sector.append(supply);
        sector.append(price);
      }
    }
  



              //+'<td>'+name+'</td>'
              //+'<td>'+fvv+'</td>'
  }
}

$('#nextday[title]').qtip()


  $('#updateProductionDetails form, input').keyup(function(event){
      employees = 0; 
      capital = 0;

      employees = Number((document.getElementById('employeesUpdate').value));
      capital = Number((document.getElementById('capitalUpdate').value));

      marginalEmployees = employees + 1;
      marginalCapital = capital + 1;

      cost = player.predictiveCost(employees, capital);
      income = player.predictIncome(employees, capital);
      marginalCost = player.predictiveCost(marginalEmployees, marginalCapital);
      marginalIncome = player.predictIncome(marginalEmployees, marginalCapital)

      $("#laborCost").text(cost.laborCost);
      $("#capitalCost").text(cost.capitalCost);
      $("#landCost").text(cost.landCost);
      $("#totalCost").text(cost.totalCost);
      
      $("#priceOutput").text(income.price);
      $("#quantityOutput").text(income.output);
      $("#incomeOutput").text(income.totalIncome);
      $("#profitGoods").text((income.totalIncome)-(cost.totalCost));
      output = employees*capital
      if((output) > (player.capcity)){sellOutput
        $("#businessAdviceOUTPUT").text('You are producing over-capcity, upgrade your business to be able to produce more. Your capcity is ' + player.capcity + ' and you are producing ' + output + '. The penalty of producing over capcity is a -'+ round((((output)-income.output)/output)*100,2) + '% decrease on final output.');
      } else{
         $("#businessAdviceOUTPUT").text("");
      }

      if(((marginalIncome.totalIncome)-(income.totalIncome))>((marginalCost.totalCost)-(cost.totalCost))){ //this follows profit maximisation rule in economics whereby MR=MC. If MR>MC then the company should produce more output as they can make additional profit. If however, MR<MC the company should reduce output as additional output is making a loss.
        $("#businessAdvicePM").text("Produce More, since MR>MC, you will be able to make more profit.");

      } else{
        $("#businessAdvicePM").text("Produce Less, since MR<MC you will be able to make more profit.");
      }

  });

    Market.list = {};
    Competitor.list = {};
    Country.list = {};

start_game = function(){
  $( ".overview" ).hide();

   //when the <submit> button is clicked
  $('#businessSubmit').click(function(){
  //store the user's entry in a variable


  
    var name = document.getElementById('name').value; //find business name
    var sector = document.getElementById("sectorPrices").value; //find sector
    var capital = parseFloat(document.getElementById('capital').value); //find business name
    var employees = parseFloat(document.getElementById('employees').value); //find business name
    $( ".intro" ).hide();
   
    $( ".overview" ).show();


    player = new Player("Ed", "Primary", 2, 2, 20, 'player',2,10, "France");

    player.cash = 50;


    $("#companyName").append(player.name);
    $("#numberEmployees").append(player.employees);
    $("#numberCapital").append(player.capital);
    $("#foreCastedIncome").append(player.income-player.expenses);
    $("#cash").append(player.cash);
    //update the html in the second form to show the user's entered name  
    Tick();
    });
}



updateProductionDetails = function(){
  $('#productionCreate').click(function(){
      player.capital = Number(document.getElementById('capitalUpdate').value);
      player.employees =  Number(document.getElementById('employeesUpdate').value);
      $("#numberEmployees").text(player.employees);
      $("#numberCapital").text(player.capital);

      player.produceOutput(player.employees,player.capital);



  });


  $('#startUp').click(function(){
      player.firstUpgrade();
      $('#startUp').attr('disabled', true);
  });
}

sellStock = function(){
  $('#sellOutput').click(function(){
    amount=Number(document.getElementById('sellAmount').value);
    if(amount<=player.stock){
      player.sellOutput(amount);
      validateStock();
      $('#sellOutput').attr("disabled", true);
    }
    
  });
}

validateStock = function(){
  if(game.tickCount == 1 && player.stock == 0){
     $('#nextday').attr("disabled", true);
  } else{
    $('#nextday').attr("disabled", false);
  }
}

function round(value, precision) {
    var multiplier = Math.pow(10, precision || 0);
    return Math.round(value * multiplier) / multiplier;
}


updateProductionDetails();

sellStock();






function produceGoods(){
  for(var key in Competitor.list){
    Competitor.list[key].produce(); //loops through businesses and produces output and demand
  } 
 
}

function demandOfFactors(){
  for(var key in Competitor.list){
    Competitor.list[key].demandOfFactors(); //loops through businesses and produces output and demand
  } 
}

function generatePrice(){
  for(var key in Market.list){
    Market.list[key].generatePrice(); //loops through markets and determines the price of these goods
  }
  for(var key in Country.list){
    Country.list[key].generatePrice(key);
  }
}

function cyclicalDemand(){
  for(var key in Market.list){
    Market.list[key].demand = Market.list[key].demand * Market.list[key].cycliacalDemand();
  }
}


function exchangeGoods(){
  for(var key in Competitor.list){
    Competitor.list[key].exchange(); //loops through businesses and sells/buys good prdouced.
  }
  
}

function checkCashFlow(){
  for(var key2 in Competitor.list){
   // Business.list[key2].generateExpenseFactor();
    Competitor.list[key2].checkCashFlow(); 
  }
}

function addBusinesses(){
  for(key in Market.list){
    Market.list[key].newEntrants();
  }
}

function immigration(){
  if(game.tickCount>5){
    for(key in Country.list){
      Country.list[key].immigrate(key);
      Country.list[key].capitalMovement(key);
    }
  }
}

function resetDemandCountry(){
  for(var key in Country.list){
    Country.list[key].resetDemand(key);
  }
}
function resetDemandMarket(){
  for(key in Market.list){
    Market.list[key].resetDay(); 
  }
}

function resetDemand(){
  resetDemandMarket();
  resetDemandCountry();
  LaborPrices = {};
  $('#sellOutput').attr("disabled", false);
}

function upgrade(){
    for(var key3 in Competitor.list){
   // Business.list[key2].generateExpenseFactor();
    Competitor.list[key3].upgrade() 
  }
}

function shocks(){
  for(var key in Country.list){
    Country.list[key].countryShock(key);
  }
}

start_game();

Tick = function(){

  
  resetDemand();
  produceGoods();
  
  demandOfFactors();

  cyclicalDemand();

  shocks();

  

  generatePrice();


  exchangeGoods();

  checkCashFlow();

  

  //InvestmentCapital();

  upgrade();
 
  player.upgrade();
  player.produce(); 
  updateUI();
  immigration();

/*
  updateChart();
  Market.list["labor"].updateChartLabor();
  Market.list["capital"].updateChartCapital();

*/


  
  addBusinesses()
  game.tickCount++;
  
}

generateMarket();
generateCountry();
            
Competitor.generate(20, "random", "random"); //Generate competitor


modifyDOM();
function test2(){
  CountryDOM = []
  for (var key in Market.list) {
    CountryDOM.push(Market.list[key].country);
    }


  var UniqueCounties = CountryDOM.filter(function(elem, pos) {
    return CountryDOM.indexOf(elem) == pos;  //http://mikeheavers.com/tutorials/removing_duplicates_in_an_array_using_javascript/
  });
  var w = window;
  for (var i = 0; i < UniqueCounties.length; i++) {
    simple = UniqueCounties[i].replace(/\s+/, "") 
    return w["price_level"+simple] = [];
  }
}

test2();
</script>

<script src="files/chartdata.js"></script>


</script>
</html>